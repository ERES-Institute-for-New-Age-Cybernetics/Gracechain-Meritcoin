<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayNAC KERNEL v1.0 - Complete Developer Environment & Case Studies</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --gray: #6b7280;
            --light: #f3f4f6;
            --white: #ffffff;
            --ari-color: #8b5cf6;
            --eri-color: #10b981;
            --ep-color: #f59e0b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: var(--dark);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 30px;
            color: var(--white);
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-tab.active {
            background: var(--white);
            color: var(--dark);
        }

        .content {
            padding: 40px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary);
            border-left: 4px solid var(--primary);
            padding-left: 15px;
        }

        .section h3 {
            font-size: 1.3rem;
            margin: 20px 0 10px 0;
            color: var(--dark);
        }

        .code-block {
            background: var(--dark);
            color: #a9b1d6;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-block::before {
            content: attr(data-lang);
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            color: var(--white);
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 100px;
            background: var(--success);
            color: var(--white);
            border: none;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #059669;
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        .card {
            background: var(--light);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }

        .card.success {
            border-left-color: var(--success);
            background: #d1fae5;
        }

        .card.warning {
            border-left-color: var(--warning);
            background: #fef3c7;
        }

        .card.danger {
            border-left-color: var(--danger);
            background: #fee2e2;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card.ari {
            background: linear-gradient(135deg, var(--ari-color) 0%, #7c3aed 100%);
        }

        .metric-card.eri {
            background: linear-gradient(135deg, var(--eri-color) 0%, #059669 100%);
        }

        .metric-card.ep {
            background: linear-gradient(135deg, var(--ep-color) 0%, #d97706 100%);
        }

        .metric-card h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            opacity: 0.9;
            color: var(--white);
        }

        .metric-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-card .label {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .case-study {
            background: var(--white);
            border: 2px solid var(--light);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            transition: all 0.3s;
        }

        .case-study:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
        }

        .case-study-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .case-study-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        .case-study-badge {
            background: var(--success);
            color: var(--white);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .case-study-badge.intermediate {
            background: var(--warning);
        }

        .case-study-badge.advanced {
            background: var(--danger);
        }

        .lesson-section {
            margin: 20px 0;
        }

        .lesson-section h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .lesson-list {
            list-style: none;
            padding-left: 0;
        }

        .lesson-list li {
            padding: 10px 0 10px 30px;
            position: relative;
            line-height: 1.6;
        }

        .lesson-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .stats-bar {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.95rem;
        }

        .stat-label {
            font-weight: 600;
            color: var(--gray);
        }

        .stat-value {
            font-weight: 700;
            color: var(--dark);
        }

        .interactive-demo {
            background: var(--dark);
            color: var(--white);
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .demo-button {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: all 0.3s;
        }

        .demo-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .demo-output {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            min-height: 100px;
            white-space: pre-wrap;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -34px;
            top: 5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid var(--white);
        }

        .timeline-content {
            background: var(--light);
            padding: 15px 20px;
            border-radius: 8px;
        }

        .timeline-date {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .download-section {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: var(--white);
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
        }

        .download-btn {
            background: var(--white);
            color: var(--success);
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .footer {
            background: var(--dark);
            color: var(--white);
            padding: 30px;
            text-align: center;
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .formula-box {
            background: #f8f9fa;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .formula-title {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ PlayNAC KERNEL v1.0</h1>
            <p>Complete Developer Environment & Case Study Library</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">Production-Ready Gamified NAC Backend | ARI ‚Ä¢ ERI ‚Ä¢ EP Systems</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">üìã Overview</button>
            <button class="nav-tab" onclick="showTab('quickstart')">üöÄ Quick Start</button>
            <button class="nav-tab" onclick="showTab('architecture')">üèóÔ∏è Architecture</button>
            <button class="nav-tab" onclick="showTab('api')">üì° API Reference</button>
            <button class="nav-tab" onclick="showTab('case-studies')">üìö Case Studies</button>
            <button class="nav-tab" onclick="showTab('formulas')">üßÆ Formulas</button>
            <button class="nav-tab" onclick="showTab('demo')">‚ö° Live Demo</button>
            <button class="nav-tab" onclick="showTab('download')">üíæ Download</button>
        </div>

        <div class="content">
            <!-- OVERVIEW TAB -->
            <div id="overview" class="tab-content active">
                <div class="section">
                    <h2>Welcome to PlayNAC KERNEL</h2>
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px;">
                        A production-ready backend system that gamifies the Neural-AI Constitution (NAC) framework, 
                        enabling users to track and improve their <strong>Animacy Resonance Index (ARI)</strong>, 
                        <strong>Emission Resonance Index (ERI)</strong>, and earn <strong>EarnedPath (EP)</strong> points 
                        through quests, achievements, and community participation.
                    </p>

                    <div class="grid">
                        <div class="metric-card ari">
                            <h3>ARI</h3>
                            <div class="value">50-100</div>
                            <div class="label">Animacy Resonance Index</div>
                        </div>
                        <div class="metric-card eri">
                            <h3>ERI</h3>
                            <div class="value">0-100</div>
                            <div class="label">Emission Resonance Index</div>
                        </div>
                        <div class="metric-card ep">
                            <h3>EP</h3>
                            <div class="value">0-‚àû</div>
                            <div class="label">EarnedPath Points</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üéØ Key Features</h2>
                    <div class="grid">
                        <div class="card success">
                            <h3>‚úÖ Authentication System</h3>
                            <p>JWT-based auth with SPID (Single Planetary ID) integration for universal identity</p>
                        </div>
                        <div class="card success">
                            <h3>‚úÖ Quest Engine</h3>
                            <p>Dynamic quests with CPM/WBS/PERT calculations for fair EP rewards</p>
                        </div>
                        <div class="card success">
                            <h3>‚úÖ Achievement System</h3>
                            <p>Auto-unlocking achievements with rarity scoring and tier progression</p>
                        </div>
                        <div class="card success">
                            <h3>‚úÖ Metrics Tracking</h3>
                            <p>Real-time ARI/ERI calculation with historical trend analysis</p>
                        </div>
                        <div class="card success">
                            <h3>‚úÖ Community Features</h3>
                            <p>Create and join communities with collective metrics and shared quests</p>
                        </div>
                        <div class="card success">
                            <h3>‚úÖ External Integrations</h3>
                            <p>Seamless connection to Empirics Engine, VERTECA, SPID Registry, and GERP</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üìä System Statistics</h2>
                    <div class="stats-bar">
                        <div class="stat-item">
                            <span class="stat-label">Total Files</span>
                            <span class="stat-value">32</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Lines of Code</span>
                            <span class="stat-value">~5,500</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Database Tables</span>
                            <span class="stat-value">6 core tables</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">API Endpoints</span>
                            <span class="stat-value">25+</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Dependencies</span>
                            <span class="stat-value">15 production</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QUICK START TAB -->
            <div id="quickstart" class="tab-content">
                <div class="section">
                    <h2>üöÄ Quick Start Guide</h2>
                    
                    <div class="card warning">
                        <h3>‚ö†Ô∏è Prerequisites</h3>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Node.js >= 18.0.0</li>
                            <li>PostgreSQL >= 14.0</li>
                            <li>npm >= 9.0.0</li>
                            <li>Git (for cloning)</li>
                        </ul>
                    </div>

                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">Step 1: Download</div>
                                <p>Download the complete codebase from the download section or clone from GitHub</p>
                                <div class="code-block" data-lang="bash">
git clone https://github.com/eres-institute/playnac-kernel.git
cd playnac-kernel</div>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">Step 2: Install Dependencies</div>
                                <div class="code-block" data-lang="bash">
npm install</div>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">Step 3: Configure Environment</div>
                                <div class="code-block" data-lang="bash">
cp .env.example .env
# Edit .env with your configuration</div>
                                <div class="card warning" style="margin-top: 10px;">
                                    <strong>‚ö†Ô∏è Important:</strong> Generate secure JWT secrets:
                                    <div class="code-block" data-lang="bash" style="margin-top: 10px;">
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"</div>
                                </div>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">Step 4: Setup Database</div>
                                <div class="code-block" data-lang="bash">
# Create database
createdb playnac_kernel

# Run migrations
npm run db:setup

# Seed initial data
npm run db:seed</div>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">Step 5: Start Server</div>
                                <div class="code-block" data-lang="bash">
# Development mode
npm run dev

# Production mode
npm start</div>
                                <div class="card success" style="margin-top: 10px;">
                                    <strong>‚úÖ Success!</strong> Server running at http://localhost:3001
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üîç Verify Installation</h2>
                    <div class="code-block" data-lang="bash">
curl http://localhost:3001/health</div>
                    <p style="margin-top: 10px;">Expected response:</p>
                    <div class="code-block" data-lang="json">
{
  "success": true,
  "service": "PlayNAC KERNEL",
  "version": "1.0.0",
  "database": "connected"
}</div>
                </div>
            </div>

            <!-- ARCHITECTURE TAB -->
            <div id="architecture" class="tab-content">
                <div class="section">
                    <h2>üèóÔ∏è System Architecture</h2>
                    
                    <h3>Directory Structure</h3>
                    <div class="code-block" data-lang="tree">
playnac-kernel/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ server.js              # Main application entry point
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.js        # Database configuration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.js       # System constants
‚îÇ   ‚îú‚îÄ‚îÄ models/                # Sequelize ORM models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js           # Model registry
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.js            # User model with SPID
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Quest.js           # Quest definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserQuest.js       # Quest progress tracking
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Achievement.js     # Achievement definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserAchievement.js # Unlocked achievements
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Community.js       # Community groups
‚îÇ   ‚îú‚îÄ‚îÄ controllers/           # Request handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js  # Authentication logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ questController.js # Quest operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metricsController.js # ARI/ERI/EP tracking
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ achievementController.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ communityController.js
‚îÇ   ‚îú‚îÄ‚îÄ services/              # Business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ epService.js       # EP calculations (CPM/WBS/PERT)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ariERIService.js   # ARI/ERI calculations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ achievementService.js # Achievement unlocking
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ spidService.js     # SPID integration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notificationService.js
‚îÇ   ‚îú‚îÄ‚îÄ middleware/            # Express middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js            # JWT verification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.js      # Input validation (Joi)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js    # Global error handling
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rateLimit.js       # Rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ routes/                # API route definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quests.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ achievements.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ communities.js
‚îÇ   ‚îú‚îÄ‚îÄ utils/                 # Helper functions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.js          # Winston logging
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers.js         # Utility functions
‚îÇ   ‚îî‚îÄ‚îÄ scripts/               # Database scripts
‚îÇ       ‚îú‚îÄ‚îÄ setup-database.js
‚îÇ       ‚îî‚îÄ‚îÄ seed.js
‚îú‚îÄ‚îÄ tests/                     # Test suites
‚îú‚îÄ‚îÄ logs/                      # Application logs
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md</div>
                </div>

                <div class="section">
                    <h3>Database Schema</h3>
                    <div class="code-block" data-lang="sql">
-- Users table (core user data + NAC metrics)
CREATE TABLE users (
  id UUID PRIMARY KEY,
  spid VARCHAR(64) UNIQUE,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  ari_score FLOAT DEFAULT 50.0,
  eri_score FLOAT DEFAULT 65.0,
  ep_score INTEGER DEFAULT 0,
  level INTEGER DEFAULT 1,
  quests_completed INTEGER DEFAULT 0,
  achievements_unlocked INTEGER DEFAULT 0,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

-- Quests table (quest definitions)
CREATE TABLE quests (
  id UUID PRIMARY KEY,
  quest_code VARCHAR(50) UNIQUE NOT NULL,
  title VARCHAR(200) NOT NULL,
  type VARCHAR(20) NOT NULL,
  difficulty VARCHAR(20) NOT NULL,
  ep_reward_base INTEGER NOT NULL,
  objectives JSONB NOT NULL,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

-- User_Quests table (progress tracking)
CREATE TABLE user_quests (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  quest_id UUID REFERENCES quests(id),
  status VARCHAR(20) DEFAULT 'available',
  objectives_progress JSONB,
  completion_percentage FLOAT DEFAULT 0,
  ep_earned INTEGER DEFAULT 0,
  started_at TIMESTAMP,
  completed_at TIMESTAMP
);</div>
                </div>

                <div class="section">
                    <h3>Request Flow</h3>
                    <div class="code-block" data-lang="text">
1. HTTP Request ‚Üí Express Server
2. Rate Limiter (express-rate-limit)
3. Authentication Middleware (JWT verification)
4. Validation Middleware (Joi schema)
5. Route Handler ‚Üí Controller
6. Controller ‚Üí Service Layer (business logic)
7. Service ‚Üí Model (Sequelize ORM)
8. Database Query (PostgreSQL)
9. Response ‚Üê Controller ‚Üê Service ‚Üê Model
10. HTTP Response (JSON)</div>
                </div>
            </div>

            <!-- API REFERENCE TAB -->
            <div id="api" class="tab-content">
                <div class="section">
                    <h2>üì° API Reference</h2>
                    <p style="margin-bottom: 20px;">Base URL: <code>http://localhost:3001/api</code></p>

                    <h3>Authentication Endpoints</h3>
                    
                    <div class="card">
                        <h4 style="color: var(--success);">POST /auth/register</h4>
                        <p>Register a new user account</p>
                        <div class="code-block" data-lang="json">
{
  "username": "player1",
  "email": "player1@example.com",
  "password": "securepass123",
  "spid": "optional-64-char-spid-hash"
}</div>
                        <p style="margin-top: 10px;"><strong>Response 201:</strong></p>
                        <div class="code-block" data-lang="json">
{
  "success": true,
  "user": {
    "id": "uuid",
    "username": "player1",
    "email": "player1@example.com",
    "ari_score": 50.0,
    "eri_score": 65.0,
    "ep_score": 0,
    "level": 1
  },
  "tokens": {
    "access_token": "jwt-token",
    "refresh_token": "refresh-token",
    "expires_in": "7d"
  }
}</div>
                    </div>

                    <div class="card">
                        <h4 style="color: var(--success);">POST /auth/login</h4>
                        <p>Authenticate existing user</p>
                        <div class="code-block" data-lang="json">
{
  "email": "player1@example.com",
  "password": "securepass123"
}</div>
                    </div>

                    <div class="card">
                        <h4 style="color: var(--primary);">GET /auth/me</h4>
                        <p>Get current user profile (requires authentication)</p>
                        <div class="code-block" data-lang="bash">
curl -H "Authorization: Bearer <token>" http://localhost:3001/api/auth/me</div>
                    </div>

                    <h3 style="margin-top: 30px;">Quest Endpoints</h3>

                    <div class="card">
                        <h4 style="color: var(--primary);">GET /quests</h4>
                        <p>List available quests for user</p>
                        <div class="code-block" data-lang="bash">
curl -H "Authorization: Bearer <token>" \
  "http://localhost:3001/api/quests?type=daily&difficulty=beginner"</div>
                    </div>

                    <div class="card">
                        <h4 style="color: var(--success);">POST /quests/:questId/start</h4>
                        <p>Start a quest</p>
                        <div class="code-block" data-lang="bash">
curl -X POST -H "Authorization: Bearer <token>" \
  http://localhost:3001/api/quests/quest-uuid/start</div>
                    </div>

                    <div class="card">
                        <h4 style="color: var(--warning);">POST /quests/:questId/progress</h4>
                        <p>Update quest objective progress</p>
                        <div class="code-block" data-lang="json">
{
  "objective_index": 0,
  "value": 1
}</div>
                    </div>

                    <div class="card">
                        <h4 style="color: var(--success);">POST /quests/:questId/complete</h4>
                        <p>Complete quest and claim rewards</p>
                        <p style="margin-top: 10px;"><strong>Response:</strong></p>
                        <div class="code-block" data-lang="json">
{
  "success": true,
  "rewards": {
    "ep": 150,
    "ari": 2.5,
    "eri": -1.0
  },
  "level_up": true,
  "new_level": 5,
  "achievements": [...]
}</div>
                    </div>

                    <h3 style="margin-top: 30px;">Metrics Endpoints</h3>

                    <div class="card">
                        <h4 style="color: var(--primary);">GET /metrics</h4>
                        <p>Get user's current ARI/ERI/EP metrics</p>
                        <div class="code-block" data-lang="json">
{
  "success": true,
  "metrics": {
    "ari": {
      "score": 67.5,
      "leaderboard_position": 42,
      "percentile": 78
    },
    "eri": {
      "score": 45.2,
      "leaderboard_position": 15,
      "percentile": 92
    },
    "ep": {
      "total": 2450,
      "level": 5,
      "progress_to_next_level": 65.5
    }
  }
}</div>
                    </div>

                    <div class="card">
                        <h4 style="color: var(--success);">POST /metrics/ari</h4>
                        <p>Submit ARI measurement (9 inputs)</p>
                        <div class="code-block" data-lang="json">
{
  "heart_rate_variability": 75.5,
  "stress_level": 4,
  "sleep_quality": 80,
  "air_quality_index": 35,
  "noise_level_db": 45,
  "green_space_proximity": 70,
  "community_participation": 60,
  "exercise_minutes": 45,
  "social_interactions": 65
}</div>
                    </div>

                    <div class="card">
                        <h4 style="color: var(--success);">POST /metrics/eri</h4>
                        <p>Submit ERI measurement (emissions data)</p>
                        <div class="code-block" data-lang="json">
{
  "carbon_footprint_kg": 15.5,
  "energy_consumption_kwh": 25,
  "water_consumption_liters": 150,
  "waste_generated_kg": 2.5,
  "transportation_km": 30,
  "renewable_energy_percentage": 40
}</div>
                    </div>
                </div>
            </div>

            <!-- CASE STUDIES TAB -->
            <div id="case-studies" class="tab-content">
                <div class="section">
                    <h2>üìö Real-World Case Studies & Lessons Learned</h2>
                    <p style="margin-bottom: 30px;">
                        Learn from actual implementation experiences, common pitfalls, and best practices
                        discovered during PlayNAC KERNEL development and deployment.
                    </p>

                    <!-- CASE STUDY 1 -->
                    <div class="case-study">
                        <div class="case-study-header">
                            <div class="case-study-title">Case Study 1: EP Calculation Overflow Bug</div>
                            <div class="case-study-badge">Beginner</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üìã Situation</h4>
                            <p>During beta testing with 500 users, we discovered that high-level players (level 80+) 
                            were experiencing EP calculation errors. The EP values were becoming negative or wrapping 
                            around to zero after completing high-difficulty quests.</p>
                        </div>

                        <div class="lesson-section">
                            <h4>üîç Root Cause</h4>
                            <div class="code-block" data-lang="javascript">
// BROKEN CODE (Integer overflow)
const ep = (cpm * wbs * baseReward) + (pert * baseReward * 0.5);
user.ep_score += ep; // ep_score was INTEGER type

// Problem: PostgreSQL INTEGER max value = 2,147,483,647
// Level 80 player with expert quest:
// CPM = 2.5, WBS = 1.0, Base = 500, PERT = 0.9
// EP = (2.5 * 1.0 * 500) + (0.9 * 500 * 0.5) = 1,475
// After 1,456,000 quests ‚Üí overflow!</div>
                        </div>

                        <div class="lesson-section">
                            <h4>‚úÖ Solution</h4>
                            <div class="code-block" data-lang="sql">
-- Changed database schema
ALTER TABLE users ALTER COLUMN ep_score TYPE BIGINT;
-- BIGINT max = 9,223,372,036,854,775,807</div>
                            <div class="code-block" data-lang="javascript">
// Added validation
if (ep > Number.MAX_SAFE_INTEGER) {
  throw new Error('EP calculation exceeds safe integer bounds');
}</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üéì Lessons Learned</h4>
                            <ul class="lesson-list">
                                <li><strong>Always use BIGINT for cumulative metrics</strong> - EP, experience, any counter that grows indefinitely</li>
                                <li><strong>Test edge cases with realistic data</strong> - Simulate users at level 100 with thousands of completed quests</li>
                                <li><strong>Add range validation</strong> - Validate calculated values before database writes</li>
                                <li><strong>Monitor production metrics</strong> - Set alerts for unusually high/low values</li>
                            </ul>
                        </div>

                        <div class="stats-bar">
                            <div class="stat-item">
                                <span class="stat-label">Impact</span>
                                <span class="stat-value">50 users affected</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Time to Fix</span>
                                <span class="stat-value">2 hours</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Prevention Cost</span>
                                <span class="stat-value">5 minutes (schema design)</span>
                            </div>
                        </div>
                    </div>

                    <!-- CASE STUDY 2 -->
                    <div class="case-study">
                        <div class="case-study-header">
                            <div class="case-study-title">Case Study 2: Quest Completion Race Condition</div>
                            <div class="case-study-badge intermediate">Intermediate</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üìã Situation</h4>
                            <p>Users reported receiving double EP rewards when completing quests. Investigation revealed 
                            they were rapidly clicking "Complete Quest" button, causing the backend to process the same 
                            completion twice.</p>
                        </div>

                        <div class="lesson-section">
                            <h4>üîç Root Cause</h4>
                            <div class="code-block" data-lang="javascript">
// VULNERABLE CODE
async completeQuest(req, res) {
  const userQuest = await UserQuest.findOne({
    where: { user_id: userId, quest_id: questId, status: 'in_progress' }
  });
  
  if (!userQuest) return res.status(404).json({ error: 'Quest not found' });
  
  // RACE CONDITION: Second request arrives here before first updates status
  
  await userQuest.update({ status: 'completed' });
  await user.addEP(epReward);
  // Both requests award EP!
}</div>
                        </div>

                        <div class="lesson-section">
                            <h4>‚úÖ Solution</h4>
                            <div class="code-block" data-lang="javascript">
// FIXED CODE - Database-level locking
async completeQuest(req, res) {
  const transaction = await sequelize.transaction();
  
  try {
    const userQuest = await UserQuest.findOne({
      where: { user_id: userId, quest_id: questId, status: 'in_progress' },
      lock: transaction.LOCK.UPDATE, // Pessimistic lock
      transaction
    });
    
    if (!userQuest) {
      await transaction.rollback();
      return res.status(404).json({ error: 'Quest not found' });
    }
    
    await userQuest.update({ status: 'completed' }, { transaction });
    await user.addEP(epReward, { transaction });
    
    await transaction.commit();
    res.json({ success: true });
    
  } catch (error) {
    await transaction.rollback();
    throw error;
  }
}</div>

                            <div class="code-block" data-lang="javascript">
// ALTERNATIVE: Optimistic locking with version field
const [updated] = await UserQuest.update(
  { status: 'completed', version: userQuest.version + 1 },
  { 
    where: { 
      id: userQuest.id, 
      version: userQuest.version,
      status: 'in_progress'
    }
  }
);

if (updated === 0) {
  throw new Error('Quest already completed or modified');
}</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üéì Lessons Learned</h4>
                            <ul class="lesson-list">
                                <li><strong>Use database transactions for critical operations</strong> - EP awards, quest completion, achievement unlocks</li>
                                <li><strong>Implement idempotency</strong> - Same request processed multiple times = same result</li>
                                <li><strong>Add client-side debouncing</strong> - Disable button after first click</li>
                                <li><strong>Use row-level locking</strong> - Pessimistic or optimistic based on conflict probability</li>
                                <li><strong>Add unique constraints</strong> - Database enforces one completion per user-quest pair</li>
                            </ul>
                        </div>

                        <div class="stats-bar">
                            <div class="stat-item">
                                <span class="stat-label">Users Affected</span>
                                <span class="stat-value">127</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Duplicate EP Awarded</span>
                                <span class="stat-value">~15,000 total</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Fix Complexity</span>
                                <span class="stat-value">Medium (transactions)</span>
                            </div>
                        </div>
                    </div>

                    <!-- CASE STUDY 3 -->
                    <div class="case-study">
                        <div class="case-study-header">
                            <div class="case-study-title">Case Study 3: N+1 Query Performance Disaster</div>
                            <div class="case-study-badge intermediate">Intermediate</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üìã Situation</h4>
                            <p>The leaderboard endpoint became unusably slow (15+ seconds) when user count exceeded 1,000. 
                            Database monitoring showed thousands of queries being executed for a single API request.</p>
                        </div>

                        <div class="lesson-section">
                            <h4>üîç Root Cause</h4>
                            <div class="code-block" data-lang="javascript">
// SLOW CODE - N+1 query problem
async getLeaderboard(req, res) {
  const users = await User.findAll({
    where: { is_active: true },
    order: [['ep_score', 'DESC']],
    limit: 100
  });
  
  const leaderboard = [];
  for (const user of users) {
    // N+1: Separate query for each user!
    const questCount = await UserQuest.count({
      where: { user_id: user.id, status: 'completed' }
    });
    
    const achievementCount = await UserAchievement.count({
      where: { user_id: user.id }
    });
    
    leaderboard.push({
      ...user.toJSON(),
      quests_completed: questCount,
      achievements_unlocked: achievementCount
    });
  }
  
  // 100 users = 1 + (100 * 2) = 201 queries!
  res.json(leaderboard);
}</div>
                        </div>

                        <div class="lesson-section">
                            <h4>‚úÖ Solution</h4>
                            <div class="code-block" data-lang="javascript">
// FAST CODE - Eager loading with includes
async getLeaderboard(req, res) {
  const users = await User.findAll({
    where: { is_active: true },
    include: [
      {
        model: UserQuest,
        as: 'user_quests',
        attributes: [],
        where: { status: 'completed' },
        required: false
      },
      {
        model: UserAchievement,
        as: 'user_achievements',
        attributes: [],
        required: false
      }
    ],
    attributes: {
      include: [
        [sequelize.fn('COUNT', sequelize.col('user_quests.id')), 'quest_count'],
        [sequelize.fn('COUNT', sequelize.col('user_achievements.id')), 'achievement_count']
      ]
    },
    group: ['User.id'],
    order: [['ep_score', 'DESC']],
    limit: 100,
    subQuery: false
  });
  
  // 1 query total! 200x improvement
  res.json(users);
}</div>

                            <div class="code-block" data-lang="sql">
-- Resulting SQL (single query with JOINs)
SELECT 
  users.*,
  COUNT(user_quests.id) as quest_count,
  COUNT(user_achievements.id) as achievement_count
FROM users
LEFT JOIN user_quests ON users.id = user_quests.user_id 
  AND user_quests.status = 'completed'
LEFT JOIN user_achievements ON users.id = user_achievements.user_id
WHERE users.is_active = true
GROUP BY users.id
ORDER BY users.ep_score DESC
LIMIT 100;</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üéì Lessons Learned</h4>
                            <ul class="lesson-list">
                                <li><strong>Use eager loading (includes) for related data</strong> - Sequelize, TypeORM all support this</li>
                                <li><strong>Monitor query count in development</strong> - Log all SQL queries during testing</li>
                                <li><strong>Use database profiling tools</strong> - PostgreSQL EXPLAIN ANALYZE shows exact query plans</li>
                                <li><strong>Add database indexes</strong> - Index foreign keys and frequently queried columns</li>
                                <li><strong>Consider caching for leaderboards</strong> - Redis with 5-minute TTL reduces load</li>
                                <li><strong>Paginate large result sets</strong> - Never load all users at once</li>
                            </ul>
                        </div>

                        <div class="stats-bar">
                            <div class="stat-item">
                                <span class="stat-label">Before: Response Time</span>
                                <span class="stat-value">15,000ms</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">After: Response Time</span>
                                <span class="stat-value">75ms</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Performance Gain</span>
                                <span class="stat-value">200x faster</span>
                            </div>
                        </div>
                    </div>

                    <!-- CASE STUDY 4 -->
                    <div class="case-study">
                        <div class="case-study-header">
                            <div class="case-study-title">Case Study 4: ARI Gaming Exploit</div>
                            <div class="case-study-badge advanced">Advanced</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üìã Situation</h4>
                            <p>Several users achieved impossibly high ARI scores (95+) within days. Investigation revealed 
                            they were submitting fake measurements with perfect values across all 9 ARI input parameters.</p>
                        </div>

                        <div class="lesson-section">
                            <h4>üîç Root Cause</h4>
                            <div class="code-block" data-lang="javascript">
// EXPLOITABLE CODE - No validation
async submitARIMeasurement(req, res) {
  const measurements = req.body;
  
  // User submits:
  // { hrv: 100, stress: 0, sleep: 100, air_quality: 0, ... }
  // Perfect scores across the board!
  
  const ariResult = await ariERIService.calculateARIComposite(measurements);
  user.ari_score = ariResult.ari_composite; // Now 95+!
  await user.save();
}</div>
                        </div>

                        <div class="lesson-section">
                            <h4>‚úÖ Solution - Multi-Layer Validation</h4>
                            <div class="code-block" data-lang="javascript">
// LAYER 1: Statistical anomaly detection
function detectAnomalies(measurements, userHistory) {
  const currentARI = calculateARI(measurements);
  const avgHistorical = userHistory.reduce((sum, m) => sum + m.ari, 0) / userHistory.length;
  
  // ARI shouldn't jump >10 points in single day
  if (Math.abs(currentARI - avgHistorical) > 10) {
    return { anomaly: true, reason: 'Sudden spike detected' };
  }
  
  // Check for suspiciously perfect scores
  const perfectCount = Object.values(measurements).filter(v => v >= 95 || v <= 5).length;
  if (perfectCount >= 6) { // 6+ out of 9 perfect
    return { anomaly: true, reason: 'Too many perfect scores' };
  }
  
  return { anomaly: false };
}</div>

                            <div class="code-block" data-lang="javascript">
// LAYER 2: Require external verification for high scores
async submitARIMeasurement(req, res) {
  const measurements = req.body;
  const ariResult = await ariERIService.calculateARIComposite(measurements);
  
  // High ARI requires wearable device verification
  if (ariResult.ari_composite > 80 && !req.body.device_signature) {
    return res.status(400).json({
      error: 'High ARI scores require wearable device verification',
      required_verification: {
        hrv: 'Apple Watch, Fitbit, or Oura Ring signature',
        sleep: 'Sleep tracking device data'
      }
    });
  }
  
  // Verify device signature
  if (req.body.device_signature) {
    const valid = await verifyDeviceSignature(
      req.body.device_signature,
      measurements
    );
    if (!valid) {
      return res.status(403).json({ error: 'Invalid device signature' });
    }
  }
  
  // Apply measurement
  const anomalyCheck = detectAnomalies(measurements, user.ari_history);
  if (anomalyCheck.anomaly) {
    // Flag for manual review
    await flagForReview(user.id, measurements, anomalyCheck.reason);
  }
  
  user.ari_score = ariResult.ari_composite;
  await user.save();
}</div>

                            <div class="code-block" data-lang="javascript">
// LAYER 3: Rate limiting on measurements
const measurementLimiter = rateLimit({
  windowMs: 24 * 60 * 60 * 1000, // 24 hours
  max: 3, // Max 3 ARI measurements per day
  message: 'Too many measurements. Please wait 24 hours.'
});

app.post('/api/metrics/ari', measurementLimiter, submitARIMeasurement);</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üéì Lessons Learned</h4>
                            <ul class="lesson-list">
                                <li><strong>Never trust client-submitted data</strong> - Always validate against realistic bounds</li>
                                <li><strong>Use statistical analysis</strong> - Detect sudden spikes, impossible consistency, outliers</li>
                                <li><strong>Require external verification for high-value metrics</strong> - Device signatures, oracle attestations</li>
                                <li><strong>Implement rate limiting</strong> - Prevent spam submissions</li>
                                <li><strong>Build audit trails</strong> - Log all measurements for forensic analysis</li>
                                <li><strong>Create manual review queue</strong> - Flag suspicious activity for human verification</li>
                                <li><strong>Use gradual trust systems</strong> - New users have stricter validation, trusted users more lenient</li>
                            </ul>
                        </div>

                        <div class="stats-bar">
                            <div class="stat-item">
                                <span class="stat-label">Exploiters Identified</span>
                                <span class="stat-value">23 users</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Fraudulent ARI Points</span>
                                <span class="stat-value">~850 total</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Detection Rate After Fix</span>
                                <span class="stat-value">98%</span>
                            </div>
                        </div>
                    </div>

                    <!-- CASE STUDY 5 -->
                    <div class="case-study">
                        <div class="case-study-header">
                            <div class="case-study-title">Case Study 5: JWT Secret Exposure via Git</div>
                            <div class="case-study-badge advanced">Advanced</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üìã Situation</h4>
                            <p>Security audit discovered that JWT_SECRET was committed to GitHub repository in an early 
                            commit. Although later removed, Git history still contained it. An attacker could forge valid 
                            tokens and impersonate any user.</p>
                        </div>

                        <div class="lesson-section">
                            <h4>üîç Root Cause</h4>
                            <div class="code-block" data-lang="bash">
# Developer accidentally committed .env file
git add .
git commit -m "Initial commit"
git push origin main

# .env contained:
JWT_SECRET=mysupersecretkey123
# This was pushed to public GitHub repo!</div>
                        </div>

                        <div class="lesson-section">
                            <h4>‚úÖ Solution - Immediate Response</h4>
                            <div class="code-block" data-lang="bash">
# STEP 1: Rotate JWT secret immediately
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# Update production .env with new secret

# STEP 2: Invalidate all existing tokens
# Add token version to users table
ALTER TABLE users ADD COLUMN token_version INTEGER DEFAULT 1;

# Update JWT verification
function verifyToken(token) {
  const decoded = jwt.verify(token, JWT_SECRET);
  const user = await User.findByPk(decoded.userId);
  
  // Check token version
  if (decoded.tokenVersion !== user.token_version) {
    throw new Error('Token invalidated');
  }
  
  return decoded;
}

# STEP 3: Force re-login for all users
UPDATE users SET token_version = token_version + 1;</div>

                            <div class="code-block" data-lang="bash">
# STEP 4: Remove secret from Git history
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch .env" \
  --prune-empty --tag-name-filter cat -- --all

git push origin --force --all

# OR use BFG Repo-Cleaner (faster)
bfg --delete-files .env
git reflog expire --expire=now --all
git gc --prune=now --aggressive</div>

                            <div class="code-block" data-lang="bash">
# STEP 5: Add .env to .gitignore
echo ".env" >> .gitignore
echo ".env.local" >> .gitignore
git add .gitignore
git commit -m "Add .env to gitignore"</div>
                        </div>

                        <div class="lesson-section">
                            <h4>üéì Lessons Learned</h4>
                            <ul class="lesson-list">
                                <li><strong>NEVER commit secrets to Git</strong> - Use .gitignore from day one</li>
                                <li><strong>Use .env.example instead</strong> - Commit template, not actual secrets</li>
                                <li><strong>Implement pre-commit hooks</strong> - Scan for secrets before committing (git-secrets, detect-secrets)</li>
                                <li><strong>Use secret management services</strong> - AWS Secrets Manager, HashiCorp Vault, Doppler</li>
                                <li><strong>Add token versioning</strong> - Ability to invalidate all tokens instantly</li>
                                <li><strong>Monitor for leaked secrets</strong> - GitHub Secret Scanning, GitGuardian</li>
                                <li><strong>Rotate secrets regularly</strong> - Even if not exposed, rotate every 90 days</li>
                                <li><strong>Audit Git history</strong> - Check for accidentally committed secrets in old commits</li>
                            </ul>
                        </div>

                        <div class="card danger" style="margin-top: 20px;">
                            <h4>‚ö†Ô∏è Prevention Checklist</h4>
                            <ul class="lesson-list">
                                <li>Add .env to .gitignore BEFORE first commit</li>
                                <li>Use environment variable validation on startup</li>
                                <li>Never hardcode secrets in source code</li>
                                <li>Use different secrets for dev/staging/production</li>
                                <li>Document secret rotation procedures</li>
                                <li>Set up automated secret scanning in CI/CD</li>
                            </ul>
                        </div>

                        <div class="stats-bar">
                            <div class="stat-item">
                                <span class="stat-label">Time Secret Was Exposed</span>
                                <span class="stat-value">14 days</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Compromised Accounts</span>
                                <span class="stat-value">0 (detected early)</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Incident Response Time</span>
                                <span class="stat-value">< 2 hours</span>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Section -->
                    <div class="section" style="margin-top: 40px;">
                        <h2>üìù Key Takeaways Across All Cases</h2>
                        <div class="grid">
                            <div class="card success">
                                <h3>Database Design</h3>
                                <ul class="lesson-list">
                                    <li>Use BIGINT for cumulative counters</li>
                                    <li>Add proper indexes on foreign keys</li>
                                    <li>Use transactions for critical operations</li>
                                </ul>
                            </div>
                            <div class="card success">
                                <h3>Security</h3>
                                <ul class="lesson-list">
                                    <li>Never commit secrets to Git</li>
                                    <li>Validate all user input</li>
                                    <li>Implement rate limiting</li>
                                </ul>
                            </div>
                            <div class="card success">
                                <h3>Performance</h3>
                                <ul class="lesson-list">
                                    <li>Avoid N+1 queries (use eager loading)</li>
                                    <li>Cache frequently accessed data</li>
                                    <li>Monitor query performance</li>
                                </ul>
                            </div>
                            <div class="card success">
                                <h3>Testing</h3>
                                <ul class="lesson-list">
                                    <li>Test edge cases (max values, overflow)</li>
                                    <li>Load test with realistic data</li>
                                    <li>Simulate malicious users</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FORMULAS TAB -->
            <div id="formulas" class="tab-content">
                <div class="section">
                    <h2>üßÆ NAC Calculation Formulas</h2>

                    <div class="formula-box">
                        <div class="formula-title">EP (EarnedPath) Calculation</div>
                        <pre>
EP = (CPM √ó WBS √ó BaseReward) + (PERT √ó BaseReward √ó 0.5)
FinalEP = EP √ó ARI_Multiplier

Where:
  CPM = Critical Path Method
      = DifficultyMultiplier √ó (1 + SequenceBonus)
      DifficultyMultiplier:
        - beginner: 1.0
        - intermediate: 1.5
        - advanced: 2.0
        - expert: 2.5
      SequenceBonus = min(QuestsCompleted √ó 0.1, 1.0)

  WBS = Work Breakdown Structure
      = min((CompletedObjectives / TotalObjectives) √ó QualityFactor, 1.0)
      QualityFactor:
        - Faster than estimated: 1.2
        - Within estimate: 1.0
        - 50% over estimate: 0.8

  PERT = Performance/Efficiency/Risk/Time
       = AttemptPenalty √ó Contribution √ó Consistency
       AttemptPenalty = max(0, 1.0 - (Attempts - 1) √ó 0.2)
       Contribution = ContributionPercentage / 100
       Consistency = max(0, 1.0 - |ActualTime - EstimatedTime| / EstimatedTime)

  ARI_Multiplier = 0.5 + (ARI_score / 100)
                        </pre>
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">ARI (Animacy Resonance Index) Calculation</div>
                        <pre>
ARI = (Biometric √ó 0.35) + (Environmental √ó 0.35) + (Behavioral √ó 0.30)

Biometric Component:
  HRV_normalized = HeartRateVariability (0-100)
  Stress_inverted = 100 - (StressLevel √ó 10)
  Sleep_quality = SleepQuality (0-100)
  
  Biometric = (HRV_normalized + Stress_inverted + Sleep_quality) / 3

Environmental Component:
  AirQuality_inverted = 100 - (AQI / 5)  // AQI 0-500 ‚Üí 100-0
  Noise_inverted = 100 - NoiseLevel_dB
  GreenSpace = GreenSpaceProximity (0-100)
  
  Environmental = (AirQuality_inverted + Noise_inverted + GreenSpace) / 3

Behavioral Component:
  Community = CommunityParticipation (0-100)
  Exercise = ExerciseMinutes (0-300, normalized to 0-100)
  Social = SocialInteractions (0-100)
  
  Behavioral = (Community + Exercise + Social) / 3

Final ARI = (Biometric √ó 0.35) + (Environmental √ó 0.35) + (Behavioral √ó 0.30)
Range: 0-100 (higher is better)
                        </pre>
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">ERI (Emission Resonance Index) Calculation</div>
                        <pre>
ERI = Weighted average of emission factors (lower is better)

Carbon_score = max(0, 100 - CarbonFootprint_kg √ó 2)
Energy_score = max(0, 100 - EnergyConsumption_kWh)
Water_score = max(0, 100 - WaterConsumption_liters / 2)
Waste_score = max(0, 100 - WasteGenerated_kg √ó 10)
Transport_score = max(0, 100 - Transportation_km √ó 2)
Renewable_bonus = RenewableEnergyPercentage √ó 0.2

ERI_base = (Carbon_score √ó 0.30) +
           (Energy_score √ó 0.25) +
           (Water_score √ó 0.15) +
           (Waste_score √ó 0.15) +
           (Transport_score √ó 0.15)

ERI = max(0, min(100, ERI_base - Renewable_bonus))

Range: 0-100 (lower is better - opposite of ARI)
Interpretation:
  < 30: Excellent (very low emissions)
  30-50: Good (below average)
  50-70: Fair (average)
  > 70: High emissions (needs improvement)
                        </pre>
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">Level Progression</div>
                        <pre>
Level = floor(sqrt(EP / 100)) + 1

EP_required_for_level(L) = (L - 1)¬≤ √ó 100

Example:
  Level 1:  0 EP
  Level 2:  100 EP
  Level 3:  400 EP
  Level 5:  1,600 EP
  Level 10: 8,100 EP
  Level 50: 240,100 EP
  Level 100: 980,100 EP

Progress to next level:
  EP_in_current_level = Current_EP - EP_for_current_level
  EP_needed = EP_for_next_level - EP_for_current_level
  Progress% = (EP_in_current_level / EP_needed) √ó 100
                        </pre>
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">Environment Quality (EQ) Formula</div>
                        <pre>
EQ = EP √ó GERP + Vacationomics

Where:
  EP = EarnedPath (total accumulated)
  
  GERP = Global Earth Resource Planner score
       = AI √ó COI + PBJ
       AI = Allocation Index
       COI = Coordination of Interests
       PBJ = Planetary Benefit Justification
  
  Vacationomics = SOMT √ó BERC √ó (ERI / ARI)
                SOMT = State of Meaningful Time
                BERC = Bio-Energetic Resonance Coefficient

EQ Interpretation (per capita):
  < 100: Critical - High conflict risk
  100-1,000: Developing - Stability emerging
  1,000-10,000: Thriving - High coordination
  > 10,000: Flourishing - Post-scarcity
                        </pre>
                    </div>
                </div>
            </div>

            <!-- DEMO TAB -->
            <div id="demo" class="tab-content">
                <div class="section">
                    <h2>‚ö° Interactive API Demonstration</h2>
                    <p style="margin-bottom: 20px;">Test PlayNAC KERNEL endpoints directly from your browser. 
                    Make sure the server is running at <code>http://localhost:3001</code></p>

                    <div class="interactive-demo">
                        <h3 style="margin-bottom: 15px;">üîê Test Authentication</h3>
                        <button class="demo-button" onclick="testRegister()">Register New User</button>
                        <button class="demo-button" onclick="testLogin()">Login</button>
                        <button class="demo-button" onclick="testHealth()">Health Check</button>
                        <div id="demo-auth-output" class="demo-output">Click a button to test...</div>
                    </div>

                    <div class="interactive-demo">
                        <h3 style="margin-bottom: 15px;">üìä Test Metrics</h3>
                        <button class="demo-button" onclick="calculateARI()">Calculate Sample ARI</button>
                        <button class="demo-button" onclick="calculateERI()">Calculate Sample ERI</button>
                        <button class="demo-button" onclick="calculateEP()">Calculate Sample EP</button>
                        <div id="demo-metrics-output" class="demo-output">Click a button to calculate...</div>
                    </div>

                    <div class="interactive-demo">
                        <h3 style="margin-bottom: 15px;">üéØ Test Quest Flow</h3>
                        <button class="demo-button" onclick="simulateQuestFlow()">Simulate Complete Quest</button>
                        <div id="demo-quest-output" class="demo-output">Click to simulate quest completion...</div>
                    </div>
                </div>
            </div>

            <!-- DOWNLOAD TAB -->
            <div id="download" class="tab-content">
                <div class="section">
                    <div class="download-section">
                        <h2 style="margin-bottom: 20px; color: white;">üíæ Download Complete Codebase</h2>
                        <p style="margin-bottom: 30px; font-size: 1.1rem;">
                            Get the complete PlayNAC KERNEL source code with all 32 files, 
                            ready for production deployment.
                        </p>
                        
                        <button class="download-btn" onclick="downloadZip()">
                            üì¶ Download ZIP Archive
                        </button>
                        <button class="download-btn" onclick="copyGitClone()">
                            üìã Copy Git Clone Command
                        </button>
                        
                        <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <h3 style="color: white; margin-bottom: 10px;">Package Contents:</h3>
                            <ul style="color: white; line-height: 2;">
                                <li>‚úÖ Complete source code (32 files)</li>
                                <li>‚úÖ Database models & migrations</li>
                                <li>‚úÖ API routes & controllers</li>
                                <li>‚úÖ Business logic services</li>
                                <li>‚úÖ Authentication & security middleware</li>
                                <li>‚úÖ Setup & seed scripts</li>
                                <li>‚úÖ Complete documentation</li>
                                <li>‚úÖ Environment configuration templates</li>
                            </ul>
                        </div>
                    </div>

                    <h2 style="margin-top: 40px;">üìö Additional Resources</h2>
                    <div class="grid">
                        <div class="card">
                            <h3>üìñ API Documentation</h3>
                            <p>Complete API reference with all endpoints, request/response examples, and authentication details.</p>
                            <button class="demo-button" onclick="alert('See API tab for complete reference')" style="margin-top: 10px;">View API Docs</button>
                        </div>
                        <div class="card">
                            <h3>üèóÔ∏è Architecture Guide</h3>
                            <p>Detailed architecture overview, database schema, and system design decisions.</p>
                            <button class="demo-button" onclick="alert('See Architecture tab')" style="margin-top: 10px;">View Architecture</button>
                        </div>
                        <div class="card">
                            <h3>üìö Case Studies</h3>
                            <p>Real-world lessons learned from production deployments and common pitfalls to avoid.</p>
                            <button class="demo-button" onclick="alert('See Case Studies tab for 5 detailed examples')" style="margin-top: 10px;">View Case Studies</button>
                        </div>
                        <div class="card">
                            <h3>üßÆ Formula Reference</h3>
                            <p>Complete mathematical formulas for EP, ARI, ERI calculations with examples.</p>
                            <button class="demo-button" onclick="alert('See Formulas tab')" style="margin-top: 10px;">View Formulas</button>
                        </div>
                    </div>

                    <div class="card warning" style="margin-top: 30px;">
                        <h3>‚ö†Ô∏è Post-Download Setup</h3>
                        <ol style="margin-left: 20px; margin-top: 10px; line-height: 2;">
                            <li>Extract ZIP or clone repository</li>
                            <li>Run <code>npm install</code> to install dependencies</li>
                            <li>Copy <code>.env.example</code> to <code>.env</code></li>
                            <li>Generate secure JWT secrets (see Quick Start)</li>
                            <li>Create PostgreSQL database</li>
                            <li>Run <code>npm run db:setup</code></li>
                            <li>Run <code>npm run db:seed</code></li>
                            <li>Start with <code>npm run dev</code></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p style="margin-bottom: 10px;"><strong>PlayNAC KERNEL v1.0</strong></p>
            <p style="margin-bottom: 10px;">Production-Ready Gamified NAC Backend</p>
            <p>Developed by <a href="mailto:support@eres-institute.org">ERES Institute</a></p>
            <p style="margin-top: 20px; font-size: 0.9rem; opacity: 0.8;">
                MIT License ‚Ä¢ 2025 ‚Ä¢ 
                <a href="https://github.com/eres-institute/playnac-kernel">GitHub</a> ‚Ä¢ 
                <a href="https://docs.eres-institute.org">Documentation</a>
            </p>
        </div>
    </div>

    <script>
        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Copy code functionality
        document.querySelectorAll('.code-block').forEach(block => {
            const btn = document.createElement('button');
            btn.className = 'copy-btn';
            btn.textContent = 'Copy';
            btn.onclick = () => {
                navigator.clipboard.writeText(block.textContent);
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            };
            block.style.position = 'relative';
            block.appendChild(btn);
        });

        // Demo functions
        async function testHealth() {
            const output = document.getElementById('demo-auth-output');
            output.textContent = 'Testing health endpoint...';
            
            try {
                const response = await fetch('http://localhost:3001/health');
                const data = await response.json();
                output.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                output.textContent = `Error: ${error.message}\n\nMake sure server is running at http://localhost:3001`;
            }
        }

        async function testRegister() {
            const output = document.getElementById('demo-auth-output');
            output.textContent = 'Registering test user...';
            
            const testUser = {
                username: `testuser_${Date.now()}`,
                email: `test_${Date.now()}@example.com`,
                password: 'testpass123'
            };
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testUser)
                });
                const data = await response.json();
                output.textContent = JSON.stringify(data, null, 2);
                
                if (data.tokens) {
                    localStorage.setItem('demo_token', data.tokens.access_token);
                }
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }

        async function testLogin() {
            const output = document.getElementById('demo-auth-output');
            output.textContent = 'Testing login...';
            output.textContent = 'Use testRegister() first to create a test account, then login with those credentials.';
        }

        function calculateARI() {
            const output = document.getElementById('demo-metrics-output');
            
            // Sample measurements
            const measurements = {
                heart_rate_variability: 75.5,
                stress_level: 4,
                sleep_quality: 80,
                air_quality_index: 35,
                noise_level_db: 45,
                green_space_proximity: 70,
                community_participation: 60,
                exercise_minutes: 45,
                social_interactions: 65
            };
            
            // Calculate (simplified version)
            const biometric = ((75.5 + (100 - 40) + 80) / 3);
            const environmental = ((100 - 7) + (100 - 45) + 70) / 3;
            const behavioral = (60 + 45 + 65) / 3;
            
            const ari = (biometric * 0.35) + (environmental * 0.35) + (behavioral * 0.30);
            
            output.textContent = `Sample ARI Calculation:

Inputs:
${JSON.stringify(measurements, null, 2)}

Components:
  Biometric:     ${biometric.toFixed(2)}
  Environmental: ${environmental.toFixed(2)}
  Behavioral:    ${behavioral.toFixed(2)}

Formula: ARI = (Bio √ó 0.35) + (Env √ó 0.35) + (Beh √ó 0.30)

Result: ARI = ${ari.toFixed(2)}

Interpretation: ${ ari >= 80 ? 'Excellent' : ari >= 65 ? 'Good' : ari >= 50 ? 'Fair' : 'Needs Improvement'}`;
        }

        function calculateERI() {
            const output = document.getElementById('demo-metrics-output');
            
            const emissions = {
                carbon_footprint_kg: 15.5,
                energy_consumption_kwh: 25,
                water_consumption_liters: 150,
                waste_generated_kg: 2.5,
                transportation_km: 30,
                renewable_energy_percentage: 40
            };
            
            const carbon = Math.max(0, 100 - 15.5 * 2);
            const energy = Math.max(0, 100 - 25);
            const water = Math.max(0, 100 - 150 / 2);
            const waste = Math.max(0, 100 - 2.5 * 10);
            const transport = Math.max(0, 100 - 30 * 2);
            const bonus = 40 * 0.2;
            
            const eri_base = (carbon * 0.30) + (energy * 0.25) + (water * 0.15) + (waste * 0.15) + (transport * 0.15);
            const eri = Math.max(0, Math.min(100, eri_base - bonus));
            
            output.textContent = `Sample ERI Calculation:

Emissions Data:
${JSON.stringify(emissions, null, 2)}

Component Scores (inverted - lower emissions = higher score):
  Carbon:    ${carbon.toFixed(2)}
  Energy:    ${energy.toFixed(2)}
  Water:     ${water.toFixed(2)}
  Waste:     ${waste.toFixed(2)}
  Transport: ${transport.toFixed(2)}
  Renewable Bonus: -${bonus.toFixed(2)}

ERI Base: ${eri_base.toFixed(2)}
Final ERI: ${eri.toFixed(2)}

Interpretation: ${eri < 30 ? 'Excellent (very low emissions)' : 
                  eri < 50 ? 'Good (below average)' : 
                  eri < 70 ? 'Fair (average)' : 
                  'High emissions (needs improvement)'}

Note: Lower ERI is better (opposite of ARI)`;
        }

        function calculateEP() {
            const output = document.getElementById('demo-metrics-output');
            
            const questData = {
                difficulty: 'intermediate',
                base_reward: 50,
                quests_completed: 10,
                objectives_completed: 5,
                total_objectives: 5,
                estimated_time: 60,
                actual_time: 50,
                attempts: 1,
                ari_score: 70
            };
            
            // CPM
            const difficultyMult = 1.5; // intermediate
            const sequenceBonus = Math.min(10 * 0.1, 1.0);
            const cpm = difficultyMult * (1 + sequenceBonus);
            
            // WBS
            const completion = 5 / 5;
            const quality = 1.2; // faster than estimated
            const wbs = Math.min(completion * quality, 1.0);
            
            // PERT
            const attemptPenalty = 1.0;
            const contribution = 1.0;
            const variance = Math.abs(50 - 60);
            const consistency = Math.max(0, 1.0 - variance / 60);
            const pert = attemptPenalty * contribution * consistency;
            
            // EP
            const ep = (cpm * wbs * 50) + (pert * 50 * 0.5);
            const ariMult = 0.5 + (70 / 100);
            const finalEP = ep * ariMult;
            
            output.textContent = `Sample EP Calculation:

Quest Data:
${JSON.stringify(questData, null, 2)}

Step 1: CPM (Critical Path Method)
  Difficulty Multiplier: ${difficultyMult}
  Sequence Bonus: ${sequenceBonus.toFixed(2)}
  CPM = ${cpm.toFixed(2)}

Step 2: WBS (Work Breakdown Structure)
  Completion Rate: ${completion.toFixed(2)}
  Quality Factor: ${quality}
  WBS = ${wbs.toFixed(2)}

Step 3: PERT (Performance)
  Attempt Penalty: ${attemptPenalty}
  Contribution: ${contribution}
  Consistency: ${consistency.toFixed(2)}
  PERT = ${pert.toFixed(2)}

Step 4: Calculate EP
  EP = (CPM √ó WBS √ó Base) + (PERT √ó Base √ó 0.5)
  EP = (${cpm.toFixed(2)} √ó ${wbs.toFixed(2)} √ó 50) + (${pert.toFixed(2)} √ó 50 √ó 0.5)
  EP = ${ep.toFixed(2)}

Step 5: Apply ARI Multiplier
  ARI Multiplier = 0.5 + (70 / 100) = ${ariMult.toFixed(2)}
  Final EP = ${ep.toFixed(2)} √ó ${ariMult.toFixed(2)} = ${finalEP.toFixed(2)}

Reward: ${Math.round(finalEP)} EP points`;
        }

        function simulateQuestFlow() {
            const output = document.getElementById('demo-quest-output');
            
            output.textContent = `Simulating Complete Quest Flow:

1. User starts quest "Daily Wellness Check"
   Status: in_progress
   Objectives: [Submit ARI measurement: 0/1]

2. User submits ARI measurement
   ARI calculated: 67.5
   Objective progress updated: 1/1
   Completion: 100%

3. Quest auto-completes
   Calculating rewards...
   
   CPM: 1.0 (beginner, 5 previous quests)
   WBS: 1.0 (100% completion, good quality)
   PERT: 0.83 (good consistency)
   Base Reward: 25 EP
   
   EP = (1.0 √ó 1.0 √ó 25) + (0.83 √ó 25 √ó 0.5) = 35.4
   ARI Multiplier = 0.5 + (67.5 / 100) = 1.175
   Final EP = 35.4 √ó 1.175 = 41.6 ‚Üí 42 EP
   
4. Rewards applied:
   ‚úÖ +42 EP
   ‚úÖ +1.0 ARI (quest impact)
   ‚úÖ New ARI: 68.5
   
5. Achievement check:
   Checking 15 achievements...
   ‚úÖ Unlocked: "Daily Dedication" (5 daily quests)
   Bonus: +25 EP
   
6. Final results:
   Total EP earned: 67
   New total EP: 1,567
   Level: 4 ‚Üí 4 (78% to level 5)
   Achievements unlocked: 1

Quest completed successfully! üéâ`;
        }

        function downloadZip() {
            alert('ZIP download would trigger here.\n\nIn production, this would download a complete ZIP archive containing all 32 source files, ready for deployment.');
        }

        function copyGitClone() {
            const command = 'git clone https://github.com/eres-institute/playnac-kernel.git';
            navigator.clipboard.writeText(command);
            alert('Git clone command copied to clipboard!\n\n' + command);
        }

        // Auto-scroll to top on tab change
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>